<!DOCTYPE html>
<html lang="en"
      xmlns="http://www.w3.org/1999/html"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Orders Manager</title>
    <th:block th:fragment="common-head">
        <meta charset="UTF-8">
        <meta content="width=device-width, initial-scale=1" name="viewport">
        <link rel="shortcut icon" th:href="@{img/favicon.png}" type="image/x-icon">
        <script crossorigin th:src="@{js/jquery.min.js}"></script>
        <script crossorigin th:src="@{js/popper.min.js}"></script>
        <script crossorigin th:src="@{js/bootstrap.min.js}"></script>
        <script crossorigin th:src="@{js/angular.js}"></script>
        <script crossorigin th:src="@{js/a076d05399.js}"></script><!--icon Font Awesome 5-->
        <link crossorigin rel="stylesheet" th:href="@{css/bootstrap.min.css}">
        <link crossorigin rel="stylesheet" th:href="@{css/font-awesome.min.css}">
        <link crossorigin rel="stylesheet" th:href="@{css/master.css}">
    </th:block>
    <script crossorigin th:src="@{js/ng-order.js}"></script>
</head>
<body>
<nav class="navbar navbar-expand-md bg-primary navbar-dark bshadow" th:fragment="nav-bar">
    <a class="navbar-brand" href="/">###<span sec:authentication="name"></span>###</a>
    <button class="navbar-toggler" data-target="#collapsibleNavbar" data-toggle="collapse" type="button">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="collapsibleNavbar">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" href="/orders">
                    <i class='fas fa-store' style='font-size:18px'></i>
                    Orders
                </a>
            </li>
            <li class="nav-item" sec:authorize="hasRole('ADMIN')">
                <a class="nav-link" href="/users">
                    <i class='fas fa-user-alt' style='font-size:18px'></i>
                    Users
                </a>
            </li>
            <!--            <li class="nav-item" sec:authorize="hasRole('ADMIN')">-->
            <!--                <a class="nav-link" href="/trace">-->
            <!--                    <i class='fas fa-exclamation-triangle' style='font-size:18px'></i>-->
            <!--                    Tracing-->
            <!--                </a>-->
            <!--            </li>-->
            <li class="nav-item">
                <a class="nav-link" href="/logout">
                    <i class='fas fa-sign-out-alt' style='font-size:18px'></i>
                    Logout
                </a>
            </li>
        </ul>
    </div>
</nav>
<div class="container mt-2" ng-app="ordersManagerment" ng-controller="ordersController">
    <h3>### Orders Manager ###</h3>
    <div class="input-group mb-3 bshadow">
        <input class="form-control non-boder-radius" ng-model="seacrhFilter.code" placeholder="Search by Code..."
               type="text">
        <input class="form-control non-boder-radius" ng-model="seacrhFilter.createBy"
               placeholder="Search by Create By..."
               sec:authorize="hasRole('ADMIN')"
               type="text">
        <div class="input-group-append">
            <button class="btn btn-success non-boder-radius" data-backdrop="static" data-target="#modelOrder"
                    data-toggle="modal" ng-click="clearData()" type="button">
                <i class='fas fa-plus-square' style='font-size:18px;color: white'></i> Add Order
            </button>
        </div>
    </div>
    <div class="table-responsive bshadow">
        <table class="table table-hover table-bordered">
            <thead>
            <tr>
                <th>Code</th>
                <th>Detail</th>
                <th style="min-width: 120px">Note</th>
                <th style="min-width: 360px">Image</th>
                <th style="min-width: 172px">Create Date</th>
                <th>Create By</th>
                <th ng-click="sortChecked(this)" sec:authorize="hasRole('ADMIN')">Check</th>
                <th sec:authorize="hasRole('ADMIN')">Action</th>
            </tr>
            </thead>
            <tbody>
            <tr ng-repeat="o in orders | orderBy:createDate:true | filter:seacrhFilter ">
                <td ng-class="{'checked-style' : o.checked}"> {{ o.code }}</td>
                <td ng-class="{'checked-style' : o.checked}"> {{ o.name }}</td>
                <td ng-class="{'checked-style' : o.checked}"> {{ o.note }}</td>
                <td ng-class="{'checked-style' : o.checked}">
                    <span data-backdrop="static" data-target="#modelImg" data-toggle="modal"
                          ng-click="showImg(o.listImg, o.id)" ng-repeat="img in o.listImg">
                        <img class="img-thumbnail img-thumbnail-inTable"
                             ng-src="/api/orders/image/{{o.id}}/{{img.shortName}}"/>
                    </span>
                </td>
                <td ng-class="{'checked-style' : o.checked}"> {{ o.createDate | date:
                    'yyyy-MM-dd HH:mm:ss' }}
                </td>
                <td ng-class="{'checked-style' : o.checked}"> {{ o.createBy }}</td>
                <td sec:authorize="hasRole('ADMIN')">
                    <div class="custom-control custom-checkbox">
                        <input class="custom-control-input" id="{{o.id}}" ng-click="toggleChecked(o)"
                               ng-model="o.checked" type="checkbox"/>
                        <label class="custom-control-label" for="{{o.id}}"></label>
                    </div>
                </td>
                <td sec:authorize="hasRole('ADMIN')">
                    <a data-backdrop="static" data-target="#modelOrder" data-toggle="modal" ng-click="editOrder(o)">
                        <i class='fas fa-edit' style='font-size:18px;color:blue'> Edit</i>
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <!-- The Modal -->
    <div class="modal fade" id="modelOrder">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">{{orderForm.type ? 'Edit' : 'Create'}} Order</h4>
                    <button class="close" data-dismiss="modal" type="button">&times;</button>
                </div>
                <form ng-submit="submitOrder()">
                    <!-- Modal body -->
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="code">Code:</label>
                            <input autocomplete="off" class="form-control" id="code" name="code"
                                   ng-model="orderForm.code" type="text"/>
                        </div>
                        <div class="form-group">
                            <label for="name">Name:</label>
                            <input autocomplete="off" class="form-control" id="name" name="name"
                                   ng-model="orderForm.name" required="true" type="text"/>
                        </div>
                        <div class="form-group">
                            <label for="note">Note:</label>
                            <textarea class="form-control" id="note" name="note" ng-model="orderForm.note"
                                      rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <input accept="image/*" class="form-control-file" file-model="orderForm.files"
                                   multiple="multiple" type="file"/>
                        </div>
                    </div>
                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <input class="btn btn-primary" type="submit" value="Submit"/>
                        <button class="btn btn-secondary" data-dismiss="modal" type="button">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade" id="modelImg">
        <div class="modal-dialog modal-dialog-centered modal-xl">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">View Image</h4>
                    <button class="close" data-dismiss="modal" type="button">&times;</button>
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <div class="carousel slide" data-ride="carousel" id="img-show">
                        <ul class="carousel-indicators" id="carousel-indicators">
                        </ul>
                        <div class="carousel-inner" id="carousel-inner">
                        </div>
                        <a class="carousel-control-prev" data-slide="prev" href="#img-show">
                            <span class="carousel-control-prev-icon"></span>
                        </a>
                        <a class="carousel-control-next" data-slide="next" href="#img-show">
                            <span class="carousel-control-next-icon"></span>
                        </a>
                    </div>

                </div>
                <!-- Modal footer -->
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-dismiss="modal" type="button">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function clearInputFile() {
            let input = document.getElementsByClassName("form-control-file");
            for (let count = 0; count < input.length; count++) {
                input[count].value = "";
            }
        }
    </script>
</div>
</body>
</html>